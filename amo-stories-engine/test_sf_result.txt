============================= test session starts =============================
platform win32 -- Python 3.13.9, pytest-9.0.2, pluggy-1.5.0 -- C:\Users\ADMIN\miniconda3\python.exe
cachedir: .pytest_cache
rootdir: D:\Amo\ATOM_Extension_V2.8_public\amo-stories-engine
configfile: pyproject.toml
plugins: anyio-4.12.1, langsmith-0.7.6, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 56 items

tests/test_soul_forge.py::TestSoulForgeSession::test_defaults PASSED     [  1%]
tests/test_soul_forge.py::TestSoulForgeSession::test_session_id_unique PASSED [  3%]
tests/test_soul_forge.py::TestSceneChoice::test_defaults PASSED          [  5%]
tests/test_soul_forge.py::TestSceneChoice::test_with_signals PASSED      [  7%]
tests/test_soul_forge.py::TestBehavioralFingerprint::test_defaults PASSED [  8%]
tests/test_soul_forge.py::TestBehavioralFingerprint::test_custom_values PASSED [ 10%]
tests/test_soul_forge.py::TestIdentitySignals::test_defaults FAILED      [ 12%]
tests/test_soul_forge.py::TestIdentitySignals::test_custom PASSED        [ 14%]
tests/test_soul_forge.py::TestUniqueSkillExtended::test_new_fields_defaults PASSED [ 16%]
tests/test_soul_forge.py::TestUniqueSkillExtended::test_forge_fields PASSED [ 17%]
tests/test_soul_forge.py::TestApiModels::test_start_request PASSED       [ 19%]
tests/test_soul_forge.py::TestApiModels::test_choice_request PASSED      [ 21%]
tests/test_soul_forge.py::TestApiModels::test_fragment_request PASSED    [ 23%]
tests/test_soul_forge.py::TestApiModels::test_forge_request PASSED       [ 25%]
tests/test_soul_forge.py::TestApiModels::test_forge_response FAILED      [ 26%]
tests/test_soul_forge.py::TestGetScene::test_scene_1_returns_4_choices PASSED [ 28%]
tests/test_soul_forge.py::TestGetScene::test_scene_1_choices_have_text FAILED [ 30%]
tests/test_soul_forge.py::TestGetScene::test_scene_2_variant_connection PASSED [ 32%]
tests/test_soul_forge.py::TestGetScene::test_scene_2_all_variants PASSED [ 33%]
tests/test_soul_forge.py::TestGetScene::test_scene_3_fallback PASSED     [ 35%]
tests/test_soul_forge.py::TestGetScene::test_scene_4_fallback PASSED     [ 37%]
tests/test_soul_forge.py::TestGetScene::test_scene_5_no_choices PASSED   [ 39%]
tests/test_soul_forge.py::TestGetScene::test_fragment_phase_scene PASSED [ 41%]
tests/test_soul_forge.py::TestGetScene::test_forging_phase_scene PASSED  [ 42%]
tests/test_soul_forge.py::TestProcessChoice::test_records_choice PASSED  [ 44%]
tests/test_soul_forge.py::TestProcessChoice::test_advances_scene PASSED  [ 46%]
tests/test_soul_forge.py::TestProcessChoice::test_extracts_signals_scene1 PASSED [ 48%]
tests/test_soul_forge.py::TestProcessChoice::test_extracts_signals_scene1_power PASSED [ 50%]
tests/test_soul_forge.py::TestProcessChoice::test_records_raw_response_times PASSED [ 51%]
tests/test_soul_forge.py::TestProcessChoice::test_full_4_choices PASSED  [ 53%]
tests/test_soul_forge.py::TestProcessScene5Advance::test_advances_to_fragment FAILED [ 55%]
tests/test_soul_forge.py::TestProcessSoulFragment::test_records_fragment PASSED [ 57%]
tests/test_soul_forge.py::TestProcessSoulFragment::test_advances_to_forging PASSED [ 58%]
tests/test_soul_forge.py::TestComputeBehavioralFingerprint::test_returns_fingerprint PASSED [ 60%]
tests/test_soul_forge.py::TestComputeBehavioralFingerprint::test_all_dimensions_in_range PASSED [ 62%]
tests/test_soul_forge.py::TestComputeBehavioralFingerprint::test_fast_responses_high_decisiveness PASSED [ 64%]
tests/test_soul_forge.py::TestComputeBehavioralFingerprint::test_slow_responses_high_patience PASSED [ 66%]
tests/test_soul_forge.py::TestComputeBehavioralFingerprint::test_fast_sub2s_high_impulsivity PASSED [ 67%]
tests/test_soul_forge.py::TestComputeBehavioralFingerprint::test_many_revisions_high_revision_tendency PASSED [ 69%]
tests/test_soul_forge.py::TestComputeBehavioralFingerprint::test_long_fragment_high_expressiveness FAILED [ 71%]
tests/test_soul_forge.py::TestBuildIdentitySignals::test_builds_signals PASSED [ 73%]
tests/test_soul_forge.py::TestBuildIdentitySignals::test_includes_behavioral PASSED [ 75%]
tests/test_soul_forge.py::TestBuildIdentitySignals::test_fragment_data PASSED [ 76%]
tests/test_soul_forge.py::TestBuildIdentitySignals::test_with_fragment_analysis PASSED [ 78%]
tests/test_soul_forge.py::TestDeriveArchetype::test_known_combination PASSED [ 80%]
tests/test_soul_forge.py::TestDeriveArchetype::test_unknown_combination_defaults_to_wanderer PASSED [ 82%]
tests/test_soul_forge.py::TestDeriveArchetype::test_all_4_anchors_produce_archetype PASSED [ 83%]
tests/test_soul_forge.py::TestDeriveDnaTags::test_returns_list PASSED    [ 85%]
tests/test_soul_forge.py::TestDeriveDnaTags::test_max_3_tags PASSED      [ 87%]
tests/test_soul_forge.py::TestDeriveDnaTags::test_connection_produces_oath_or_charm PASSED [ 89%]
tests/test_soul_forge.py::TestForgeSkillSync::test_returns_unique_skill PASSED [ 91%]
tests/test_soul_forge.py::TestForgeSkillSync::test_skill_has_timestamp PASSED [ 92%]
tests/test_soul_forge.py::TestForgeSkillSync::test_skill_has_trait_tags PASSED [ 94%]
tests/test_soul_forge.py::TestForgeSkillSync::test_skill_resilience_defaults PASSED [ 96%]
tests/test_soul_forge.py::TestForgeSkillSync::test_different_paths_different_skills PASSED [ 98%]
tests/test_soul_forge.py::TestFullFlow::test_complete_flow_produces_skill PASSED [100%]

================================== FAILURES ===================================
______________________ TestIdentitySignals.test_defaults ______________________
tests\test_soul_forge.py:94: in test_defaults
    assert s.risk_tolerance == 0
E   AssertionError: assert 2 == 0
E    +  where 2 = IdentitySignals(void_anchor='', attachment_style='', moral_core='', decision_pattern='', conflict_response='', risk_tolerance=2, power_vs_connection=0.0, sacrifice_type='', courage_vs_cleverness='', scene_path=[], soul_fragment_raw='', soul_fragment_themes=[], soul_fragment_emotion='', soul_fragment_target='', behavioral=BehavioralFingerprint(decisiveness=0.5, deliberation=0.5, expressiveness=0.5, confidence=0.5, patience=0.5, consistency=0.5, impulsivity=0.5, revision_tendency=0.5)).risk_tolerance
______________________ TestApiModels.test_forge_response ______________________
tests\test_soul_forge.py:168: in test_forge_response
    resp = SoulForgeForgeResponse(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for SoulForgeForgeResponse
E   soul_resonance
E     Field required [type=missing, input_value={'session_id': 's1', 'pla...ity': ['mind', 'relic']}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.12/v/missing
_________________ TestGetScene.test_scene_1_choices_have_text _________________
tests\test_soul_forge.py:200: in test_scene_1_choices_have_text
    assert c.text
           ^^^^^^
E   AttributeError: 'dict' object has no attribute 'text'
_____________ TestProcessScene5Advance.test_advances_to_fragment ______________
tests\test_soul_forge.py:333: in test_advances_to_fragment
    assert s.current_scene == 6
E   AssertionError: assert 5 == 6
E    +  where 5 = SoulForgeSession(session_id='sf_85d5746399e8', user_id='u1', started_at=datetime.datetime(2026, 2, 22, 18, 20, 57, 911859, tzinfo=datetime.timezone.utc), current_scene=5, phase='fragment', scene_choices=[], scene_path=[], soul_fragment_raw='', raw_response_times=[], raw_hover_counts=[], fragment_char_count=0, fragment_typing_time_ms=0, fragment_revision_count=0, identity_signals=None, forge_attempts=0).current_scene
___ TestComputeBehavioralFingerprint.test_long_fragment_high_expressiveness ___
tests\test_soul_forge.py:407: in test_long_fragment_high_expressiveness
    assert fp.expressiveness > 0.8
E   assert 0.0 > 0.8
E    +  where 0.0 = BehavioralFingerprint(decisiveness=0.7, deliberation=0.2, expressiveness=0.0, confidence=0.75, patience=0.2, consistency=0.8, impulsivity=0.0, revision_tendency=0.0).expressiveness
=========================== short test summary info ===========================
FAILED tests/test_soul_forge.py::TestIdentitySignals::test_defaults - Asserti...
FAILED tests/test_soul_forge.py::TestApiModels::test_forge_response - pydanti...
FAILED tests/test_soul_forge.py::TestGetScene::test_scene_1_choices_have_text
FAILED tests/test_soul_forge.py::TestProcessScene5Advance::test_advances_to_fragment
FAILED tests/test_soul_forge.py::TestComputeBehavioralFingerprint::test_long_fragment_high_expressiveness
======================== 5 failed, 51 passed in 0.39s =========================
